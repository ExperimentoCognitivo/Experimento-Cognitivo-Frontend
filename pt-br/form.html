<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Experimento</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <link href="../assets/css/bootstrap.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href='../assets/css/poppins-css.css' rel='stylesheet' type='text/css'>
    <link href="../assets/css/fonts/font-awesome.min.css" rel="stylesheet">
    <link href="../assets/css/fonts/pe-icon-7-stroke.css" rel="stylesheet">
</head>

<body>
    <div class="section">
        <div class="container">
            <div class="row">
                <div class="title-area">
                    <h2>Formulário</h2>
                    <div class="mb-3">
                        <label for="genero-label" class="form-label">1 - Qual o seu gênero?</label>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="genero" id="form-radio-genero-1"
                                value="masculino" checked="true">
                            <label class="form-check-label" style="margin-right: 2%;"
                                for="inlineRadio1">Masculino</label>
                            <input class="form-check-input" type="radio" name="genero" id="form-radio-genero-2"
                                value="feminino">
                            <label class="form-check-label" style="margin-right: 2%;"
                                for="inlineRadio1">Feminino</label>
                            <input class="form-check-input" type="radio" name="genero" id="form-radio-genero-3"
                                value="outro">
                            <label class="form-check-label" style="margin-right: 2%;" for="inlineRadio1">Outro</label>

                        </div>
                    </div>

                    <br />

                    <div class="mb-3">
                        <label for="idade-label" class="form-label">2- Por favor, indique sua idade em anos.</label>
                        <div class="row">
                            <div class="col-md-2">
                                <input type="number" class="form-control" id="form-idade" placeholder="18">
                            </div>
                        </div>
                    </div>

                    <br />

                    <div class="mb-3">
                        <label for="titulo-label" class="form-label">3- Indique, aproximadamente, nos últimos dois anos
                            a
                            quantidade de vezes que você negociou qualquer título, individual ou de um fundo: (0 para
                            nenhum).</label>
                        <div class="row">
                            <div class="col-md-2">
                                <input type="number" class="form-control" id="form-titulo" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <br />

                    <div class="mb-3">
                        <label for="desempenho-label" class="form-label">4- Indique, aproximadamente, o número de vezes
                            durante a sua vida que você avaliou o desempenho financeiro de uma companhia analisando seus
                            relatórios financeiros.</label>
                        <div class="row">
                            <div class="col-md-2">
                                <input type="number" class="form-control" id="form-desempenho" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <br />

                    <div class="mb-3">
                        <label for="titulacao-label" class="form-label">5 - Selecione qual a sua maior titulação
                            acadêmica:</label>
                        <div class="form-check form-check-inline">

                            <input class="form-check-input" type="radio" name="titulacao" id="form-radio-titulacao-1"
                                value="graduando" checked="true">
                            <label class="form-check-label" style="margin-right: 2%;"
                                for="inlineRadio1">Graduando</label>

                            <input class="form-check-input" type="radio" name="titulacao" id="form-radio-titulacao-2"
                                value="graduado">
                            <label class="form-check-label" style="margin-right: 2%;"
                                for="inlineRadio1">Graduado</label>

                            <input class="form-check-input" type="radio" name="titulacao" id="form-radio-titulacao-3"
                                value="posGraduadoMba">
                            <label class="form-check-label" style="margin-right: 2%;" for="inlineRadio1">Pós-graduado /
                                Mba</label>

                            <input class="form-check-input" type="radio" name="titulacao" id="form-radio-titulacao-4"
                                value="mestre">
                            <label class="form-check-label" style="margin-right: 2%;" for="inlineRadio1">Mestre</label>

                            <input class="form-check-input" type="radio" name="titulacao" id="form-radio-titulacao-5"
                                value="doutor">
                            <label class="form-check-label" style="margin-right: 2%;" for="inlineRadio1">Doutor</label>

                        </div>
                    </div>

                    <br />

                    <div class="mb-3">
                        <label for="universidade-label" class="form-label">6- Qual a universidade onde você concluiu ou
                            está cursando?</label>
                        <div class="row">
                            <div class="col-md-5">
                                <input type="text" class="form-control" id="form-universidade" placeholder="...">
                            </div>
                        </div>
                    </div>

                    <br />

                    <div class="mb-3">
                        <label for="experiencia-label" class="form-label">7- Quantos meses de experiência profissional
                            em
                            contabilidade e / ou finanças você tem? Esta experiência pode ser em tempo integral,
                            meio-período ou um estágio :( digite 0 para nenhum).</label>
                        <div class="row">
                            <div class="col-md-2">
                                <input type="number" class="form-control" id="form-experiencia" placeholder="18">
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="info-icon">
                        <div class="button-get-started">
                            <a href="javascript:void(0)" onclick="sendForm(this)"
                                class="btn btn-danger btn-fill btn-lg">Finalizar</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer footer-big footer-color-black" data-color="black">
        <div class="container">
            <div class="copyright">
                ©
                <script> document.write(new Date().getFullYear()) </script> Criado por Frederico Sampaio
            </div>
        </div>
    </footer>
</body>
<script type="text/javascript" src="../assets/js/jquery.min.js"></script>
<script type="text/javascript" src="../assets/js/bootstrap.js"></script>
<script type="text/javascript" src="../assets/js/modernizr.js"></script>
<script type="text/javascript" src="../assets/js/core.js"></script>
<script src="../assets/js/fastest-validator.min.js"></script>
<script>
    const BASE_URL = "https://experimento-cognitivo-service.herokuapp.com";
    const validator = new FastestValidator();

    const schema = {
        gender: { type: "string" },
        age: { type: "number" },
        title: { type: "number", integer: true },
        performance: { type: "number", integer: true },
        titration: { type: "string" },
        university: { type: "string" },
        experience: { type: "number", integer: true }
    };

    const check = validator.compile(schema);

    function getAndValidForm(element) {
        const gender = getRadioValue(`[name="genero"]`);
        const age = parseInt(document.getElementById(`form-idade`).value);
        const title = parseInt(document.getElementById(`form-titulo`).value);
        const performance = parseInt(document.getElementById(`form-desempenho`).value);
        const titration = getRadioValue(`[name="titulacao"]`);
        const university = document.getElementById(`form-universidade`).value;
        const experience = parseInt(document.getElementById(`form-experiencia`).value);
        const isValid = check({ gender, age, title, performance, titration, university, experience });
        if (isValid === true) {
            return { people: { gender, age, title, performance, titration, university, experience } }
        } else {
            alert("Por favor verifique e preencha todos os campos.");
            element.removeAttribute("disabled");
            element.innerText = "Continuar";
            throw "Invalid Form";
        }
    }

    function getRadioValue(selector) {
        const fields = document.querySelectorAll(selector);
        return (Array.from(fields).find(field => field.checked)).value;
    }

    async function sendForm(element) {
        element.setAttribute("disabled", "true");
        element.innerText = "Aguarde...";
        const bodyForm = getAndValidForm(element);
        const id = localStorage.getItem("userId");
        const response = await fetch(`${BASE_URL}/v1/experiment/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "Application/json" },
            body: JSON.stringify(bodyForm)
        });
        if (response.status === 204) {
            alert("Obrigado por parcitipar do experimento!");
            localStorage.removeItem("userId");
            window.location.href = `../index.html`;
        } else {
            setTimeout(async () => {
                await sendForm(element);
            }, 5000);
        }
    }

    window.location.hash = "no-back-button";

    // Again because Google Chrome doesn't insert
    // the first hash into the history
    window.location.hash = "Again-No-back-button";

    window.onhashchange = function () {
        window.location.hash = "no-back-button";
    }

    setTimeout(() => {
        window.location.hash = "no-back-button";

        // Again because Google Chrome doesn't insert
        // the first hash into the history
        window.location.hash = "Again-No-back-button";

        window.onhashchange = function () {
            window.location.hash = "no-back-button";
        }
    }, 2000);

</script>

</html>