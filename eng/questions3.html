<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Experimento</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <link href="../assets/css/bootstrap.css" rel="stylesheet" />
    <link href="../assets/css/style.css" rel="stylesheet" />
    <link href='../assets/css/poppins-css.css' rel='stylesheet' type='text/css'>
    <link href="../assets/css/fonts/font-awesome.min.css" rel="stylesheet">
    <link href="../assets/css/fonts/pe-icon-7-stroke.css" rel="stylesheet">
</head>
<style>
    span.left-block {
        float: left;
    }

    span.right-block {
        float: right;
    }
</style>

<body>
    <div class="section">
        <div class="container">
            <div class="row">
                <div class="title-area">
                    <h2>Questions - NASA TLX workload scale</h2>
                    <br />
                    <div class="mb-3">
                        <label for="genero-label" class="form-label">1 - How mentally demanding was the task?</label>
                        <input type="range" class="form-range" min="1" max="21" id="range-1" value="0">
                        <div class="col-md-6">
                            <span class="left-block"><b style="color:red">Very Slow</b></span>
                        </div>
                        <div class="col-md-6">
                            <span class="right-block"><b style="color:green">Very High</b></span>
                        </div>
                    </div>

                    <br /><br />

                    <div class="mb-3">
                        <label for="genero-label" class="form-label">2 - How physically demanding was the task?</label>
                        <input type="range" class="form-range" min="1" max="21" id="range-2" value="0">
                        <div class="col-md-6">
                            <span class="left-block"><b style="color:red">Very Slow</b></span>
                        </div>
                        <div class="col-md-6">
                            <span class="right-block"><b style="color:green">Very High</b></span>
                        </div>
                    </div>

                    <br /><br />

                    <div class="mb-3">
                        <label for="genero-label" class="form-label">3 - How hurried or rushed was the pace of the
                            task?</label>
                        <input type="range" class="form-range" min="1" max="21" id="range-3" value="0">
                        <div class="col-md-6">
                            <span class="left-block"><b style="color:red">Very Slow</b></span>
                        </div>
                        <div class="col-md-6">
                            <span class="right-block"><b style="color:green">Very High</b></span>
                        </div>
                    </div>

                    <br /><br />

                    <div class="mb-3">
                        <label for="genero-label" class="form-label">4 - How successful were you in accomplishing what
                            you were asked to do?</label>
                        <input type="range" class="form-range" min="1" max="21" id="range-4" value="0">
                        <div class="col-md-6">
                            <span class="left-block"><b style="color:red">Failure</b></span>
                        </div>
                        <div class="col-md-6">
                            <span class="right-block"><b style="color:green">Perfect</b></span>
                        </div>
                    </div>

                    <br /><br />

                    <div class="mb-3">
                        <label for="genero-label" class="form-label">5 -How hard did you have to work to accomplish your
                            level of performance?</label>
                        <input type="range" class="form-range" min="1" max="21" id="range-5" value="0">
                        <div class="col-md-6">
                            <span class="left-block"><b style="color:red">Very Slow</b></span>
                        </div>
                        <div class="col-md-6">
                            <span class="right-block"><b style="color:green">Very High</b></span>
                        </div>
                    </div>
                    <br /><br />
                    <div class="mb-3">
                        <label for="genero-label" class="form-label">6 - How insecure, discouraged, irritated, stressed,
                            and annoyed were you?</label>
                        <input type="range" class="form-range" min="1" max="21" id="range-6" value="0">
                        <div class="col-md-6">
                            <span class="left-block"><b style="color:red">Very Slow</b></span>
                        </div>
                        <div class="col-md-6">
                            <span class="right-block"><b style="color:green">Very High</b></span>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="info-icon">
                        <div class="button-get-started">
                            <a href="javascript:void(0);" onclick="sendForm(this)"
                                class="btn btn-danger btn-fill btn-lg">Finish</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer footer-big footer-color-black" data-color="black">
        <div class="container">
            <div class="copyright">
                Â©
                <script> document.write(new Date().getFullYear()) </script> Created by Frederico Sampaio
            </div>
        </div>
    </footer>
</body>
<script type="text/javascript" src="../assets/js/jquery.min.js"></script>
<script type="text/javascript" src="../assets/js/bootstrap.js"></script>
<script type="text/javascript" src="../assets/js/modernizr.js"></script>
<script type="text/javascript" src="../assets/js/core.js"></script>
<script src="../assets/js/fastest-validator.min.js"></script>
<script>
    const input1 = document.getElementById('range-1');
    const input2 = document.getElementById('range-2');
    const input3 = document.getElementById('range-3');
    const input4 = document.getElementById('range-4');
    const input5 = document.getElementById('range-5');
    const input6 = document.getElementById('range-6');

    const inputs = [input1, input2, input3, input4, input5, input6];

    function attributeValueToInput(value, index) {
        inputs[index].value = value;
    }

    const schema = {
        first: { type: "number", integer: true, min: 1, max: 21 },
        second: { type: "number", integer: true, min: 1, max: 21 },
        third: { type: "number", integer: true, min: 1, max: 21 },
        fourth: { type: "number", integer: true, min: 1, max: 21 },
        fifth: { type: "number", integer: true, min: 1, max: 21 },
        sixth: { type: "number", integer: true, min: 1, max: 21 }
    };

    const BASE_URL = "https://experimento-cognitivo-service.herokuapp.com";
    const validator = new FastestValidator();

    const check = validator.compile(schema);

    function getAndValidForm(element) {
        const first = parseInt(input1.value);
        const second = parseInt(input2.value);
        const third = parseInt(input3.value);
        const fourth = parseInt(input4.value);
        const fifth = parseInt(input5.value);
        const sixth = parseInt(input6.value);
        const isValid = check({ first, second, third, fourth, fifth, sixth });
        if (isValid === true) {
            return { first, second, third, fourth, fifth, sixth }
        } else {
            alert("Please check and fill in all fields.");
            element.removeAttribute("disabled");
            element.innerText = "Continue";
            throw "Invalid Form";
        }
    }

    function getRadioValue(selector) {
        const fields = document.querySelectorAll(selector);
        return (Array.from(fields).find(field => field.checked)).value;
    }

    async function sendForm(element) {
        try {
            element.setAttribute("disabled", "true");
            element.innerText = "Aguarde...";
            const bodyForm = getAndValidForm(element);
            const id = localStorage.getItem("userId");
            const response = await fetch(`${BASE_URL}/v1/experiment/questions-3/${id}`, {
                method: "PATCH",
                headers: { "Content-Type": "Application/json" },
                body: JSON.stringify(bodyForm)
            });
            if (response.status === 204) {
                window.location.href = `form.html`;
            } else {
                setTimeout(async () => {
                    await sendForm(element);
                }, 5000);
            }
        } catch (err) {
            console.log(err);
            alert("Error sending data, please try again");
            element.removeAttribute("disabled");
            element.innerText = "Finish";
        }
    }


    window.location.hash = "no-back-button";

    // Again because Google Chrome doesn't insert
    // the first hash into the history
    window.location.hash = "Again-No-back-button";

    window.onhashchange = function () {
        window.location.hash = "no-back-button";
    }

    setTimeout(() => {
        window.location.hash = "no-back-button";

        // Again because Google Chrome doesn't insert
        // the first hash into the history
        window.location.hash = "Again-No-back-button";

        window.onhashchange = function () {
            window.location.hash = "no-back-button";
        }
    }, 2000);

</script>

</html>